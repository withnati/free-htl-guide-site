<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fixation â€” Pro Module | Free HTL Guide</title>
  <meta name="description" content="Master fixation for HT/HTL: mechanisms, pre-analytics, fixatives, artifacts, QC, worked scenarios, and a targeted auto-graded quiz."/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="prefetch" href="./processing.html" as="document">
  <style>
    :root{ --brand:#0F4C81; --ink:#0f172a; }
    html{ scroll-behavior:smooth }
    body{ color:var(--ink) }

    /* Premium card look */
    .card{ border-radius:1.25rem; border:1px solid #e5e7eb; background:#fff; box-shadow:0 2px 12px rgba(2,6,23,.04); }

    /* Progress bar */
    #progressBar{ position:sticky; top:0; height:4px; z-index:50;
      background:linear-gradient(to right,var(--brand) var(--pct,0%),#e5e7eb 0) }

    /* Table polish */
    .table{ border-collapse:collapse; width:100% }
    .table th,.table td{ border:1px solid #e5e7eb; padding:.6rem; vertical-align:top; line-height:1.35 }
    .table th{ background:#f8fafc; font-weight:700; cursor:pointer; position:sticky; top:0; z-index:1 }
    .table tbody tr:nth-child(even){ background:#fafafa }

    /* Quiz states (borders, not loud backgrounds) */
    fieldset.correct{ border:2px solid #10b981; background:transparent }
    fieldset.incorrect{ border:2px solid #ef4444; background:transparent }

    /* Pills */
    .pill{ padding:.15rem .5rem; border-radius:999px; background:#eef2ff; color:#1e3a8a; font-size:.8rem; font-weight:600 }

    /* Hotspot microâ€‘animation */
    @keyframes pulse{0%,100%{transform:scale(1);opacity:.95}50%{transform:scale(1.15);opacity:.6}}
    .animate-pulse{ animation:pulse 1.8s ease-in-out infinite }

    /* Print refinement */
    @media print{
      header, .toc, .actions, .notes, .quiz-actions, #helpBtn, #helpDrawer, .mobile-nav { display:none !important }
      main{ max-width:100% !important }
      article > section{ break-inside:avoid; margin-bottom:1.2rem }
      a[href]:after{ content:" (" attr(href) ")"; font-size:90% }
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark){
      body{ background:#0b1220; color:#e5e7eb }
      header, .card, nav, .toc{ background:#0d1426; color:#e5e7eb; border-color:#1f2a44 }
      .table th{ background:#121b33 }
      .table td, .table th{ border-color:#1f2a44 }
      a{ color:#8ab9ff }
    }
  </style>
</head>
<body class="antialiased bg-white">
  <!-- Sticky progress -->
  <div id="progressBar" aria-hidden="true"></div>

  <!-- Header -->
  <header class="border-b bg-white/90 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
      <nav class="text-sm text-slate-600">
        <a class="hover:text-[color:var(--brand)]" href="../index.html">Home</a>
        <span class="mx-1">â€º</span>
        <a class="hover:text-[color:var(--brand)]" href="./fixation.html">Fixation</a>
        <span class="mx-1">â€º</span>
        <strong>Pro Module</strong>
      </nav>
      <div class="flex items-center gap-2">
        <button id="markBtn" class="rounded-xl border px-3 py-2 text-sm">Mark complete</button>
        <button id="helpBtn" class="rounded-xl border px-3 py-2 text-sm">Ask a question</button>
      </div>
    </div>
  </header>

  <!-- HERO (gradient + blob + refined type) -->
  <section class="relative border-b">
    <div class="absolute inset-0 -z-10 bg-gradient-to-b from-slate-50 via-white to-white"></div>
    <div class="pointer-events-none absolute right-[-10%] top-[-20%] h-[38rem] w-[38rem] rounded-full blur-3xl opacity-20"
         style="background:radial-gradient(closest-side,#0F4C81 0%,#74a3c7 35%,transparent 70%);"></div>

    <div class="max-w-6xl mx-auto px-4 py-8 grid md:grid-cols-[1.15fr,0.85fr] md:items-center gap-8">
      <div>
        <p class="uppercase tracking-wide text-xs text-slate-500">Module â€¢ Core</p>
        <h1 class="max-w-[22ch] leading-tight text-4xl md:text-5xl font-extrabold mt-1">Fixation</h1>
        <p class="max-w-[56ch] mt-3 text-slate-600 md:text-lg">
          35â€“45Â min. Mechanisms, preâ€‘analytics &amp; QC to power highâ€‘quality H&amp;E, specials, IHC/IF, and ISH.
        </p>
        <div class="mt-4 flex flex-wrap gap-2 text-[11px] font-medium text-slate-700">
          <span class="px-2 py-1 rounded-full bg-slate-100/80 ring-1 ring-slate-200">HT skills</span>
          <span class="px-2 py-1 rounded-full bg-slate-100/80 ring-1 ring-slate-200">HTL depth</span>
          <span class="px-2 py-1 rounded-full bg-slate-100/80 ring-1 ring-slate-200">Quiz: 10Â Q</span>
        </div>
        <div class="mt-5 flex gap-3">
          <a id="startBtn" href="#start"
             class="rounded-xl px-4 py-2 text-white font-semibold"
             style="background:var(--brand)" fetchpriority="high">Start / Resume</a>
          <button id="topBtn" class="rounded-xl border px-4 py-2">Back to top</button>
        </div>
        <p class="mt-2 text-xs text-slate-500">VideoÂ 12Â m â€¢ readingÂ 10Â m â€¢ practiceÂ 15Â m</p>
      </div>

      <div class="hidden md:block relative">
        <img
  src="../assets/formaldehyde.jpg?v=1"
  alt="Brown glass formaldehyde bottle used for tissue fixation."
  class="w-full h-auto max-h-[360px] object-contain rounded-none border-0 shadow-none"
  loading="eager"
  decoding="async"
  fetchpriority="high"
/>
        <!-- animated hotspot -->
        <button class="absolute top-[26%] left-[58%] w-[18px] h-[18px] rounded-full animate-pulse"
                style="background:var(--brand)" title="Why methanol?"></button>
        <div class="absolute left-2 top-2 bg-white/90 text-xs rounded px-2 py-1 border">Hover dot â†’</div>
      </div>
    </div>
  </section>

  <!-- LAYOUT -->
  <main class="max-w-6xl mx-auto px-4 py-8 grid lg:grid-cols-[260px,1fr,320px] gap-8">
    <!-- TOC -->
    <aside class="toc hidden lg:block sticky top-24 h-max">
      <div class="card p-4">
        <p class="text-xs font-semibold tracking-wide text-slate-500">MODULE MAP</p>
        <ol id="outline" class="mt-3 space-y-2 text-sm">
          <li><a href="#start">Start</a></li>
          <li><a href="#objectives">Objectives</a></li>
          <li><a href="#prereqs">Prereqs</a></li>
          <li><a href="#lesson-1">LessonÂ 1: Mechanisms</a></li>
          <li><a href="#lesson-2">LessonÂ 2: Preâ€‘analytics</a></li>
          <li><a href="#lesson-3">LessonÂ 3: Fixatives table</a></li>
          <li><a href="#lesson-4">LessonÂ 4: Artifacts</a></li>
          <li><a href="#worked">Worked scenarios</a></li>
          <li><a href="#practice">Practice quiz</a></li>
          <li><a href="#downloads">Downloads</a></li>
          <li><a href="#summary">Summary & pitfalls</a></li>
          <li><a href="#version">Version & sources</a></li>
        </ol>
      </div>
    </aside>

    <!-- CONTENT (slightly narrower for readability on LG; expands on xl) -->
    <article id="content" class="space-y-10 max-w-[68ch] lg:max-w-none">
      <!-- Start -->
      <section id="start" class="card p-6">
        <h2 class="text-xl font-bold">Start / Resume</h2>
        <p class="text-slate-600 mt-1">Weâ€™ll remember your spot, quiz attempts, and notes on this device.</p>
        <div class="mt-3 flex gap-2 text-sm">
          <span id="progressText" class="px-2 py-1 rounded bg-slate-100">Progress:Â 0%</span>
          <span id="statusChip" class="px-2 py-1 rounded bg-slate-100">Not completed</span>
        </div>
      </section>

      <!-- Objectives -->
      <section id="objectives" class="card p-6">
        <h2 class="text-xl font-bold">ğŸ¯ Learning objectives</h2>
        <ul class="list-disc ml-5 mt-2">
          <li>Differentiate <button class="underline decoration-dotted text-[color:var(--brand)] gloss" data-term="crosslinking">crosslinking</button> vs <button class="underline decoration-dotted text-[color:var(--brand)] gloss" data-term="coagulative">coagulative</button> fixation.</li>
          <li>Select fixatives/conditions for H&amp;E, specials, IHC/IF, ISH, enzyme histochemistry.</li>
          <li>Control preâ€‘analytics (time, thickness, ratio, pH, temperature, tonicity) to prevent artifacts.</li>
          <li>Recognize & correct formalin/mercury pigments and over/underâ€‘fixation issues.</li>
          <li>Document protocols and QC to lab standards.</li>
        </ul>
        <div class="mt-4 text-sm text-slate-700 bg-amber-50 border border-amber-200 rounded-xl p-3">
          <strong>Takeaways:</strong> Crosslinking = morphology; Coagulative = speed; choose by downstream need.
        </div>
        <p class="mt-2 text-xs text-slate-500">Estimated time:Â 35â€“45Â minutes</p>
      </section>

      <!-- Prereqs -->
      <section id="prereqs" class="card p-6">
        <h2 class="text-xl font-bold">ğŸ§° Prereqs & what youâ€™ll need</h2>
        <ul class="list-disc ml-5">
          <li>Basic tissue handling + H&amp;E workflow.</li>
          <li>Materials: NBF, 95% ethanol, cold acetone, Bouinâ€™s (optional), 10% ammonium hydroxide in 70% ethanol,
              alcoholic picric acid, iodine + sodium thiosulfate.</li>
          <li>For IHC/ISH emphasis: buffer pH strips; EDTA decalc solution when applicable.</li>
        </ul>
      </section>

      <!-- Lesson 1 -->
      <section id="lesson-1" class="card p-6">
        <div class="flex justify-between items-center">
          <h2 class="text-xl font-bold">ğŸ”¬ LessonÂ 1 â€” Mechanisms</h2>
          <span class="pill">5â€“7Â min</span>
        </div>
        <ul class="list-disc ml-5 mt-2">
          <li><b>Crosslinking</b> (formaldehyde, glutaraldehyde): methylene bridges â†’ sturdy morphology; may mask epitopes (retrieval helps).</li>
          <li><b>Coagulative</b> (ethanol/methanol, acetone): precipitate proteins â†’ rapid penetration; more shrinkage/brittleness.</li>
        </ul>
        <details class="mt-3"><summary class="font-semibold cursor-pointer">Key takeaways</summary>
          <ul class="list-disc ml-5 mt-2 text-slate-700">
            <li>Crosslinking = great architecture, often needs retrieval.</li>
            <li>Coagulative = speed; cytology & frozen/enzyme work.</li>
            <li>Choose by downstream method.</li>
          </ul>
        </details>
      </section>

      <!-- Lesson 2 -->
      <section id="lesson-2" class="card p-6">
        <div class="flex justify-between items-center">
          <h2 class="text-xl font-bold">ğŸ§ª LessonÂ 2 â€” Preâ€‘analytics</h2>
          <span class="pill">7â€“8Â min</span>
        </div>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <p class="mb-2 font-semibold">Control points to memorize</p>
            <ul class="list-disc ml-5">
              <li>Time to fixation â‰¤Â 1Â h (immediate for biopsies).</li>
              <li>ThicknessÂ 3â€“5Â mm; ratio ~10:1 fixative:tissue.</li>
              <li>pH for NBF ~7.0â€“7.2; temp RT; tonicity matters.</li>
            </ul>
            <details class="mt-3"><summary class="font-semibold cursor-pointer">Why they matter</summary>
              <p class="mt-2 text-slate-700">Cold ischemia drives autolysis; uneven penetration creates false negatives; pH/tonicity shifts change staining and morphology.</p>
            </details>
          </div>
          <div class="p-3 rounded-xl bg-slate-50 border">
            <p class="font-semibold">Bench miniâ€‘checklist</p>
            <label class="block mt-2 text-sm"><input type="checkbox" class="mr-2"> Time in fixative recorded</label>
            <label class="block mt-1 text-sm"><input type="checkbox" class="mr-2"> Cassette not overcrowded</label>
            <label class="block mt-1 text-sm"><input type="checkbox" class="mr-2"> Fixative pH verified</label>
            <label class="block mt-1 text-sm"><input type="checkbox" class="mr-2"> Tissue â‰¤Â 5Â mm thick</label>
          </div>
        </div>
      </section>

      <!-- Lesson 3 -->
      <section id="lesson-3" class="card p-6">
        <div class="flex justify-between items-center">
          <h2 class="text-xl font-bold">ğŸ“‹ LessonÂ 3 â€” Fixatives table</h2>
          <span class="pill">5â€“6Â min</span>
        </div>
        <p class="text-slate-700 mb-3">Click headers to sort.</p>
        <div class="overflow-x-auto">
          <table id="fixTable" class="table text-sm">
            <thead>
              <tr><th data-key="name">Fixative</th><th data-key="type">Type</th><th data-key="best">Best use</th><th data-key="strength">Strengths</th><th data-key="caveat">Caveats</th></tr>
            </thead>
            <tbody>
              <tr><td data-name="10% Neutral Buffered Formalin">10%Â NBF</td><td>Crosslinking</td><td>UniversalÂ H&amp;E; manyÂ IHC</td><td>Goldâ€‘standard morphology</td><td>Formalin pigment if acidic; retrieval often needed</td></tr>
              <tr><td data-name="Glyoxal-based">Glyoxalâ€‘based</td><td>Crosslinking</td><td>Routine histology</td><td>Faster; less odor</td><td>Retrieval profiles differ vs NBF</td></tr>
              <tr><td data-name="Glutaraldehyde">Glutaraldehyde</td><td>Dialdehyde</td><td>EM; enzyme histochemistry</td><td>Ultrastructure preserved</td><td>Overâ€‘hardening; autofluorescence</td></tr>
              <tr><td data-name="Alcohols / Acetone">Alcohols/Acetone</td><td>Coagulant</td><td>Cytology; frozen; enzymes</td><td>Rapid; crisp nuclei</td><td>Shrinkage; brittle; poor trichromes</td></tr>
              <tr><td data-name="Bouinâ€™s">Bouinâ€™s</td><td>Compound</td><td>Testis; GI mucosa; trichromes</td><td>Great CT contrast</td><td>Yellow picrate; long wash</td></tr>
              <tr><td data-name="Zinc-formalin">Zincâ€‘formalin</td><td>Additive</td><td>IHC nuclear detail</td><td>Improved nuclei</td><td>Zinc crystals/waste handling</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Lesson 4 -->
      <section id="lesson-4" class="card p-6">
        <div class="flex justify-between items-center">
          <h2 class="text-xl font-bold">âš ï¸ LessonÂ 4 â€” Artifacts</h2>
          <span class="pill">4â€“5Â min</span>
        </div>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <p class="font-semibold">Formalin pigment (acid hematin)</p>
            <ul class="list-disc ml-5">
              <li>Brownâ€‘black birefringent granules after acidic/long fixation.</li>
              <li><b>Removal:</b> alcoholic picric acid or 10% ammonium hydroxide in 70% ethanol.</li>
            </ul>
            <p class="font-semibold mt-4">Mercury pigment</p>
            <ul class="list-disc ml-5">
              <li>Legacy fixatives (Bâ€‘5/Zenker). <b>Remove:</b> iodine â†’ sodium thiosulfate.</li>
            </ul>
          </div>
          <div>
            <details open class="mb-3"><summary class="font-semibold cursor-pointer">Easy to get wrong</summary>
              <ul class="list-disc ml-5 mt-2 text-slate-700">
                <li>Assuming â€œovernightâ€ timing fits all tissues.</li>
                <li>Skipping retrieval tuning after a fixative change.</li>
                <li>Ignoring pH drift in homeâ€‘made buffers.</li>
              </ul>
            </details>
            <p class="text-sm text-slate-600">For bone/ISH: prefer <b>EDTA</b> decalc to preserve antigens/nucleic acids.</p>
          </div>
        </div>
      </section>

      <!-- Worked scenarios -->
      <section id="worked" class="card p-6">
        <h2 class="text-xl font-bold">ğŸ§  Worked scenarios</h2>
        <div class="space-y-4 mt-2">
          <details><summary class="font-semibold cursor-pointer">S1. Small GI biopsy for H&amp;E and IHC</summary>
            <div class="mt-2 text-slate-700">
              <p><b>Plan:</b> Immediate NBF, thin grossing â‰¤3Â mm, 10:1 ratio, record times. Retrieval tuned per marker.</p>
              <button class="mt-2 rounded-xl border px-3 py-2 text-sm" onclick="this.nextElementSibling.classList.toggle('hidden');return false;">Show solution</button>
              <div class="hidden mt-2 p-3 rounded-xl bg-slate-50 border text-sm">Cold ischemia drives epitope loss; speed to fix is key. NBF supports H&amp;E and most IHC with HIER.</div>
            </div>
          </details>
          <details><summary class="font-semibold cursor-pointer">S2. Enzyme histochemistry on frozen skeletal muscle</summary>
            <div class="mt-2 text-slate-700"><b>Plan:</b> Brief cold acetone (âˆ’20Â Â°C) 30â€“60Â s; keep temps low to preserve enzyme activity.</div>
          </details>
          <details><summary class="font-semibold cursor-pointer">S3. Bone marrow core with planned ISH</summary>
            <div class="mt-2 text-slate-700"><b>Plan:</b> NBF then <b>EDTA</b> decalc; avoid strong acids; document preâ€‘analytics; validate probe with control tissue.</div>
          </details>
        </div>
      </section>

      <!-- Practice -->
      <section id="practice" class="card p-6">
        <div class="flex flex-wrap items-center gap-3 justify-between">
          <h2 class="text-xl font-bold">âœ… Practice quiz (10)</h2>
          <div class="flex items-center gap-2">
            <span class="pill">Target â‰¥Â 80%</span>
            <span id="bestScore" class="pill">Best: â€”</span>
          </div>
        </div>
        <p class="text-sm text-slate-600">Immediate feedback appears under each item.</p>

        <form id="quizForm" class="mt-4 grid gap-5 max-w-3xl">
          <fieldset data-correct="C" data-expl="Formaldehyde forms methylene bridges (crosslinking).">
            <legend class="font-medium">1) The primary chemical action of formaldehyde is:</legend>
            <label class="block mt-1"><input type="radio" name="q1" value="A"> Coagulation of proteins</label>
            <label class="block mt-1"><input type="radio" name="q1" value="B"> Oxidation of lipids</label>
            <label class="block mt-1"><input type="radio" name="q1" value="C"> Crosslinking of proteins via methylene bridges</label>
            <label class="block mt-1"><input type="radio" name="q1" value="D"> Hydrolysis of nucleic acids</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Minimize cold ischemia; speed to fix is critical.">
            <legend class="font-medium">2) Most critical preâ€‘analytic control for small GI biopsies:</legend>
            <label class="block mt-1"><input type="radio" name="q2" value="A"> High paraffin temperature</label>
            <label class="block mt-1"><input type="radio" name="q2" value="B"> Minimized time to fixation</label>
            <label class="block mt-1"><input type="radio" name="q2" value="C"> Prolonged water bath float time</label>
            <label class="block mt-1"><input type="radio" name="q2" value="D"> Use of zinc salts</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Classic acid hematin from acidic formalin or long fixation.">
            <legend class="font-medium">3) Brownâ€‘black granular pigment after long acidic formalin storage is:</legend>
            <label class="block mt-1"><input type="radio" name="q3" value="A"> Melanin</label>
            <label class="block mt-1"><input type="radio" name="q3" value="B"> Formalin pigment (acid hematin)</label>
            <label class="block mt-1"><input type="radio" name="q3" value="C"> Hemosiderin</label>
            <label class="block mt-1"><input type="radio" name="q3" value="D"> Carbon</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="C" data-expl="Iodine â†’ sodium thiosulfate removes mercury pigment.">
            <legend class="font-medium">4) Best removal for mercury pigment:</legend>
            <label class="block mt-1"><input type="radio" name="q4" value="A"> Saturated alcoholic lithium carbonate</label>
            <label class="block mt-1"><input type="radio" name="q4" value="B"> Potassium permanganate</label>
            <label class="block mt-1"><input type="radio" name="q4" value="C"> Iodine followed by sodium thiosulfate</label>
            <label class="block mt-1"><input type="radio" name="q4" value="D"> Hydrogen peroxide</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Coagulants act fast but shrink tissue; great for cytology/frozen.">
            <legend class="font-medium">5) Fixative class causing shrinkage but rapid nuclear preservation:</legend>
            <label class="block mt-1"><input type="radio" name="q5" value="A"> Dialdehydes</label>
            <label class="block mt-1"><input type="radio" name="q5" value="B"> Alcohols</label>
            <label class="block mt-1"><input type="radio" name="q5" value="C"> Aldehydes</label>
            <label class="block mt-1"><input type="radio" name="q5" value="D"> Osmium tetroxide</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="C" data-expl="EDTA preserves antigen/nucleic acids for IHC/ISH.">
            <legend class="font-medium">6) For an IHCâ€‘heavy bone marrow requiring decalcification, choose:</legend>
            <label class="block mt-1"><input type="radio" name="q6" value="A"> Strong hydrochloric acid</label>
            <label class="block mt-1"><input type="radio" name="q6" value="B"> Formic acid with heat</label>
            <label class="block mt-1"><input type="radio" name="q6" value="C"> EDTA at room temperature</label>
            <label class="block mt-1"><input type="radio" name="q6" value="D"> Trichloroacetic acid</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Two 100% stations limit water carryover.">
            <legend class="font-medium">7) The main purpose of two 100% alcohol stations is to reduce:</legend>
            <label class="block mt-1"><input type="radio" name="q7" value="A"> Overâ€‘dehydration</label>
            <label class="block mt-1"><input type="radio" name="q7" value="B"> Water carryover</label>
            <label class="block mt-1"><input type="radio" name="q7" value="C"> Brittleness</label>
            <label class="block mt-1"><input type="radio" name="q7" value="D"> Heat damage</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Overâ€‘retrieval damages morphology and raises background.">
            <legend class="font-medium">8) After very long fixation, excessive retrieval most commonly causes:</legend>
            <label class="block mt-1"><input type="radio" name="q8" value="A"> Enhanced specific signal only</label>
            <label class="block mt-1"><input type="radio" name="q8" value="B"> Loss of morphology/high background</label>
            <label class="block mt-1"><input type="radio" name="q8" value="C"> No change</label>
            <label class="block mt-1"><input type="radio" name="q8" value="D"> Stronger counterstain</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="Soften block (ice/glycerol), trim thinner, and adjust angle.">
            <legend class="font-medium">9) To reduce chatter in an overâ€‘fixed brittle block, first:</legend>
            <label class="block mt-1"><input type="radio" name="q9" value="A"> Raise water bath to 55â€“60Â Â°C</label>
            <label class="block mt-1"><input type="radio" name="q9" value="B"> Soften block, trim thinner, adjust angle</label>
            <label class="block mt-1"><input type="radio" name="q9" value="C"> Prolong xylene clearing</label>
            <label class="block mt-1"><input type="radio" name="q9" value="D"> Use a coarser blade</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>

          <fieldset data-correct="B" data-expl="NBF is buffered near neutral, ~7.0â€“7.2.">
            <legend class="font-medium">10) Typical pH of standard NBF:</legend>
            <label class="block mt-1"><input type="radio" name="q10" value="A"> 5.0â€“5.5</label>
            <label class="block mt-1"><input type="radio" name="q10" value="B"> 7.0â€“7.2</label>
            <label class="block mt-1"><input type="radio" name="q10" value="C"> 8.5â€“9.0</label>
            <label class="block mt-1"><input type="radio" name="q10" value="D"> 10.5â€“11.0</label>
            <div class="exp text-sm text-slate-700 mt-2 hidden"></div>
          </fieldset>
        </form>

        <div class="quiz-actions mt-3 flex gap-3">
          <button id="gradeBtn" type="button" class="rounded-xl px-4 py-2 text-white font-semibold" style="background:var(--brand)">Submit</button>
          <button id="retryBtn" type="button" class="rounded-xl border px-4 py-2">Retry</button>
        </div>
        <div id="quizResult" class="hidden mt-4 p-4 rounded-xl border" aria-live="polite"></div>
      </section>

      <!-- Downloads -->
      <section id="downloads" class="card p-6">
        <h2 class="text-xl font-bold">â¬‡ï¸ Downloads</h2>
        <div class="mt-3 flex flex-wrap gap-3">
          <a class="rounded-xl border px-3 py-2" href="../assets/Fixation_Quick_Card.pdf">Quickâ€‘card (PDF)</a>
          <a class="rounded-xl border px-3 py-2" href="../assets/Pigment_Removal_OnePager.pdf">Pigment removal (PDF)</a>
          <a class="rounded-xl border px-3 py-2" href="../assets/NBF_Prep_Worksheet.pdf">NBF worksheet (PDF)</a>
          <a class="rounded-xl border px-3 py-2" href="../assets/IHC_Validation_Checklist.pdf">IHC/ISH checklist (PDF)</a>
          <a class="rounded-xl px-3 py-2 text-white" style="background:var(--brand)" href="../assets/all-fixation-downloads.zip">All downloads (ZIP)</a>
        </div>
      </section>

      <!-- Summary -->
      <section id="summary" class="card p-6">
        <h2 class="text-xl font-bold">ğŸ§¾ Summary â€” what you can do now</h2>
        <ul class="list-disc ml-5">
          <li>Choose fixatives by mechanism and downstream assay.</li>
          <li>Control preâ€‘analytics to protect morphology and targets.</li>
          <li>Remove formalin/mercury pigments; adjust retrieval.</li>
          <li>Document QC and validate changes.</li>
        </ul>
        <h3 class="font-semibold mt-4">Common pitfalls</h3>
        <ul class="list-disc ml-5 text-slate-700">
          <li>Using â€œovernightâ€ timing for all tissues.</li>
          <li>Blaming poor nuclear detail solely on staining.</li>
          <li>Switching fixatives without parallel validation.</li>
        </ul>
        <div class="mt-4 actions flex justify-between">
          <a class="rounded-xl border px-3 py-2" href="./fixation.html">â† Back to module</a>
          <a class="rounded-xl border px-3 py-2" href="./processing.html">Next: Processing â†’</a>
        </div>
      </section>

      <!-- Version -->
      <section id="version" class="card p-6">
        <h2 class="text-xl font-bold">ğŸ“Œ Version & sources</h2>
        <p class="text-sm text-slate-600">Updated <span id="verDate"></span> â€¢ v1.0</p>
        <ul class="list-disc ml-5 mt-2 text-sm">
          <li>Standard histotechnology references and bench SOPs (follow local policy and assay IFUs).</li>
        </ul>
      </section>
    </article>

    <!-- RIGHT RAIL -->
    <aside class="space-y-4">
      <section class="card p-4">
        <p class="text-xs font-semibold tracking-wide text-slate-500">OBJECTIVES</p>
        <ul class="mt-2 text-sm list-disc ml-5">
          <li>Mechanisms: crosslinking vs coagulative</li>
          <li>Preâ€‘analytics control</li>
          <li>Fixatives selection</li>
          <li>Artifacts & removal</li>
        </ul>
        <p class="mt-3 text-xs text-slate-500">Time:Â 35â€“45Â min</p>
      </section>
      <section class="card p-4 notes" id="notesPanel">
        <p class="text-xs font-semibold tracking-wide text-slate-500">YOUR NOTES</p>
        <textarea id="notes" class="mt-2 w-full h-40 p-2 rounded-lg border" placeholder="Jot key takeawaysâ€¦"></textarea>
        <p class="text-xs text-slate-500 mt-1">Autosaved locally</p>
      </section>
    </aside>
  </main>

  <!-- HELP DRAWER -->
  <aside id="helpDrawer" class="fixed right-0 top-0 h-full w-[92%] sm:w-[480px] bg-white border-l shadow-xl translate-x-full transition-transform" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="h-16 px-4 border-b flex items-center justify-between">
      <h2 id="helpTitle" class="font-semibold">Ask a question</h2>
      <button id="helpClose" class="rounded-xl border px-3 py-2 text-sm">Close</button>
    </div>
    <div class="p-4 space-y-3">
      <p class="text-sm text-slate-600">Your question saves to this device. Copy/paste to email or your contact form.</p>
      <label class="text-sm">Section (optional)
        <input id="helpSection" class="mt-1 w-full rounded-lg border p-2" placeholder="e.g., LessonÂ 2 â€” Preâ€‘analytics"/>
      </label>
      <label class="text-sm">Question
        <textarea id="helpText" class="mt-1 w-full h-32 rounded-lg border p-2" placeholder="Type your questionâ€¦"></textarea>
      </label>
      <div class="flex gap-2">
        <button id="helpSave" class="rounded-xl px-3 py-2 text-white" style="background:var(--brand)">Save</button>
        <button id="helpCopy" class="rounded-xl border px-3 py-2">Copy</button>
      </div>
      <div id="helpSaved" class="text-xs text-green-700 hidden">Saved âœ“</div>
    </div>
  </aside>

  <!-- MOBILE NAV (wayfinding on phones) -->
  <nav class="mobile-nav fixed bottom-3 inset-x-0 z-40 px-3 md:hidden">
    <div class="mx-auto max-w-lg grid grid-cols-3 gap-2 rounded-2xl bg-white/95 backdrop-blur border shadow">
      <a href="#outline" class="py-2 text-center text-sm">Outline</a>
      <a href="#notesPanel" class="py-2 text-center text-sm">Notes</a>
      <button onclick="window.scrollTo({top:0,behavior:'smooth'})" class="py-2 text-sm">Top</button>
    </div>
  </nav>

  <footer class="py-10 border-t">
    <div class="max-w-6xl mx-auto px-4 text-slate-600">Â© <span id="y"></span> Free HTL Guide</div>
  </footer>

  <!-- Scripts -->
  <script>
  (function(){
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

    // Footer year + version date
    $('#y').textContent = new Date().getFullYear();
    $('#verDate').textContent = new Date().toLocaleDateString(undefined,{year:'numeric',month:'short'});

    // Progress bar & outline highlight
    const progBar = $('#progressBar');
    document.addEventListener('scroll',()=>{
      const h=document.documentElement;
      const pct=(h.scrollTop)/(h.scrollHeight-h.clientHeight)*100;
      progBar.style.setProperty('--pct', pct+'%');
    });
    if('IntersectionObserver' in window){
      const io = new IntersectionObserver(entries=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            $$('#outline a').forEach(a=>a.removeAttribute('aria-current'));
            const hit = $('#outline a[href="#'+e.target.id+'"]');
            if(hit) hit.setAttribute('aria-current','true');
          }
        });
      },{rootMargin:'-40% 0px -50% 0px',threshold:0});
      $$('#content section[id]').forEach(s=>io.observe(s));
    }

    // Start/Resume remembers last section
    const LAST='fix_pro_last';
    $('#startBtn').addEventListener('click', (ev)=>{
      const last = localStorage.getItem(LAST);
      if(last){ ev.preventDefault(); location.hash=last; }
    });
    document.addEventListener('scroll', ()=>{
      const cur = $('#outline a[aria-current="true"]');
      if(cur){ localStorage.setItem(LAST, cur.getAttribute('href').substring(1)); }
    });

    // Mark complete
    const DONE='fix_pro_done';
    const markBtn=$('#markBtn'), statusChip=$('#statusChip');
    function renderDone(){ const v=localStorage.getItem(DONE)==='1'; markBtn.textContent=v?'Completed âœ“':'Mark complete'; markBtn.setAttribute('aria-pressed',v); if(statusChip) statusChip.textContent=v?'Completed':'Not completed'; }
    markBtn.addEventListener('click',()=>{ localStorage.setItem(DONE, localStorage.getItem(DONE)==='1'?'0':'1'); renderDone(); });
    renderDone();

    // Back to top
    $('#topBtn').addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));

    // Glossary tooltips
    const defs={
      crosslinking:'Aldehydes (e.g., formaldehyde) form methylene bridges between proteins; preserves architecture.',
      coagulative:'Alcohols/acetone precipitate proteins rapidly; suited for cytology and frozen/enzyme work.'
    };
    document.addEventListener('click',(e)=>{
      const t=e.target.closest('.gloss'); if(!t) return;
      const text=defs[t.dataset.term]||'';
      let tip=t.nextElementSibling; if(!tip || !tip.classList.contains('tip')){
        tip=document.createElement('span'); tip.className='tip ml-2 text-xs bg-slate-100 border px-2 py-1 rounded-lg'; t.after(tip);
      }
      tip.textContent=text; tip.hidden=!tip.hidden;
    });

    // Sortable table
    $('#fixTable thead').addEventListener('click',(e)=>{
      const th=e.target.closest('th'); if(!th) return;
      const rows=$$('#fixTable tbody tr');
      const get=(tr)=> (tr.querySelector('[data-name]')?.dataset.name || tr.children[0].textContent).toLowerCase();
      const coll=new Intl.Collator(undefined,{numeric:true,sensitivity:'base'});
      rows.sort((a,b)=>coll.compare(get(a),get(b)));
      const tb=$('#fixTable tbody'); rows.forEach(r=>tb.appendChild(r));
    });

    // Notes autosave
    const NOTES='fix_pro_notes';
    const notes=$('#notes');
    notes.value=localStorage.getItem(NOTES)||'';
    notes.addEventListener('input',()=>localStorage.setItem(NOTES, notes.value));

    // Help drawer
    const drawer=$('#helpDrawer');
    $('#helpBtn').addEventListener('click',()=>drawer.style.transform='translateX(0)');
    $('#helpClose').addEventListener('click',()=>drawer.style.transform='translateX(100%)');
    $('#helpSave').addEventListener('click',()=>{
      const payload={section:$('#helpSection').value, text:$('#helpText').value, ts:new Date().toISOString()};
      localStorage.setItem('fix_pro_help', JSON.stringify(payload));
      $('#helpSaved').classList.remove('hidden'); setTimeout(()=>$('#helpSaved').classList.add('hidden'),1500);
    });
    $('#helpCopy').addEventListener('click', async ()=>{
      const txt=`Fixation module question\nSection: ${$('#helpSection').value}\n\n${$('#helpText').value}`;
      try{ await navigator.clipboard.writeText(txt); alert('Copied to clipboard'); }catch(e){ alert('Copy failed. Select and copy manually.'); }
    });

    // Hotspot tip
    const hero = document.querySelector('section.relative .hidden.md\\:block');
    if(hero){
      const tip=document.createElement('div');
      tip.className='hidden absolute right-2 bottom-2 max-w-[280px] p-3 rounded-xl border bg-white shadow text-sm';
      tip.innerHTML='<b>Methanol stabilizer</b><br>Commercial formalin often includes ~10â€“15% methanol to limit polymerization; this slightly changes fixation behavior vs methanolâ€‘free prep.';
      hero.appendChild(tip);
      hero.addEventListener('mouseenter',e=>{ if(e.target.tagName==='BUTTON') tip.classList.remove('hidden'); },true);
      hero.addEventListener('mouseleave',()=>tip.classList.add('hidden'),true);
    }

    // Quiz grading + best score
    const form=$('#quizForm'), res=$('#quizResult'), bestChip=$('#bestScore');
    function renderBest(){ const v=localStorage.getItem('fix_pro_best'); bestChip.textContent='Best: ' + (v? v+'%':'â€”'); }
    renderBest();

    function grade(){
      let score=0,total=0;
      $$('#quizForm fieldset').forEach(fs=>{
        total++; fs.classList.remove('correct','incorrect');
        const correct=fs.dataset.correct; const chosen=fs.querySelector('input:checked');
        const expl=fs.querySelector('.exp'); if(expl){ expl.classList.add('hidden'); expl.textContent=''; }
        if(chosen && chosen.value===correct){ score++; fs.classList.add('correct'); }
        else{ fs.classList.add('incorrect'); if(expl){ expl.textContent=fs.dataset.expl||''; expl.classList.remove('hidden'); } }
      });
      const pct=Math.round(score/total*100);
      res.classList.remove('hidden');
      res.innerHTML=`<strong>Score: ${score}/${total} (${pct}%)</strong>`;
      const prev=+(localStorage.getItem('fix_pro_best')||0);
      if(pct>prev){ localStorage.setItem('fix_pro_best', pct); renderBest(); }
    }
    function retry(){
      $$('#quizForm input[type=radio]').forEach(i=>i.checked=false);
      $$('#quizForm fieldset').forEach(fs=>fs.classList.remove('correct','incorrect'));
      $$('#quizForm .exp').forEach(e=>{e.textContent=''; e.classList.add('hidden');});
      res.classList.add('hidden');
    }
    $('#gradeBtn').addEventListener('click',grade);
    $('#retryBtn').addEventListener('click',retry);

    // Simple progress: sections viewed
    const PROG='fix_pro_seen';
    const progTxt=$('#progressText');
    let seen=new Set(JSON.parse(localStorage.getItem(PROG)||'[]'));
    function bump(id){ if(!id) return; seen.add(id); localStorage.setItem(PROG, JSON.stringify([...seen])); const pct=Math.round(seen.size / $$('#content section[id]').length * 100); progTxt.textContent='Progress: '+pct+'%'; }
    document.addEventListener('scroll',()=>{ const cur=$('#outline a[aria-current="true"]'); if(cur) bump(cur.getAttribute('href').substring(1)); });
    bump(location.hash?.substring(1));
  })();
  </script>
</body>
</html>
